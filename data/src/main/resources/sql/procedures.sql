CREATE OR REPLACE PROCEDURE ADD_USER(
  LOGIN VARCHAR2, 
  HASH_PASSWD VARCHAR2, 
  ROLE VARCHAR2, 
  ID_PEOPLE INTEGER,
  IDENT OUT INTEGER
) IS 
PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN 
	INSERT INTO USERS(LOGIN, HASH_PASSWD, ROLE, ID_PEOPLE)
	VALUES (LOGIN, HASH_PASSWD, ROLE, ID_PEOPLE)
  RETURNING ID INTO IDENT;
  COMMIT;
END;
//

CREATE OR REPLACE PROCEDURE ADD_PEOPLE(
	FIRST_NAME VARCHAR2,
	MIDDLE_NAME VARCHAR2,
	LAST_NAME VARCHAR2,
	DATE_BIRTH DATE,
	SEX VARCHAR2,
	ID_CONTACT INTEGER,
	IDENT OUT INTEGER
) IS
PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN
	INSERT INTO PEOPLES(FIRST_NAME, MIDDLE_NAME, LAST_NAME, DATE_BIRTH, SEX, ID_CONTACT)
	VALUES (FIRST_NAME, MIDDLE_NAME, LAST_NAME, DATE_BIRTH, SEX, ID_CONTACT)
	RETURNING ID INTO IDENT;
	COMMIT;
END;
//

CREATE OR REPLACE PROCEDURE ADD_CONTACT(
	PHONE VARCHAR2,
	EMAIL VARCHAR2,
	COUNTRY VARCHAR2,
	CITY VARCHAR2,
	DESCRIPTION VARCHAR2,
	IDENT OUT INTEGER
) IS
PRAGMA AUTONOMOUS_TRANSACTION;
	CNT INTEGER DEFAULT -1;
BEGIN
	SELECT ID INTO CNT
	FROM LOCATIONS L WHERE L.COUNTRY = COUNTRY AND L.CITY = CITY 
						AND L.DESCRIPTION = DESCRIPTION;
	IF CNT < 0 THEN
		INSERT INTO LOCATIONS(COUNTRY, CITY, DESCRIPTION)
		VALUES (COUNTRY, CITY, DESCRIPTION)
		RETURNING ID INTO CNT;
	END IF;
	
	INSERT INTO CONTACTS(PHONE, EMAIL, ID_LOCATION)
	VALUES (PHONE, EMAIL, CNT)
	RETURNING ID INTO IDENT;
	COMMIT;
END;
//